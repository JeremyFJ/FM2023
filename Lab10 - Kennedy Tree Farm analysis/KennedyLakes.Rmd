---
title: "Kennedy Lakes Assessment"
author: "(Your name here)"
date: "4/21/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Kennedy Tree Farm catch data

In Lab 10, let's look at how mark-recapture estimation can help us predict population sizes. In this case, we will look at data collected from the Kennedy Tree Farm Lakes. Unfortunately, we did not catch any previously tagged fish, but we can simulate this data to estimate trends in population size for the 4 lakes. 

## Collecting the data

First, let's pull the data from our database `kennedylakes`

```{r}
connectKennedy = function (dbuser, dbpass) 
{
  dbname = "kennedylakes"   # name of database
  dbhost <- "sp2.cs.vt.edu"    # host or server
  dbport <- 5432
  drv <- dbDriver("PostgreSQL")
  con <- dbConnect(drv, host = dbhost, port = dbport, dbname = dbname, 
                   user = dbuser, password = dbpass)
}

getDat = function (dbuser, dbpass) 
{
  require(RPostgreSQL)
  require(DBI)
  require(RH2)
  con = connectKennedy(dbuser, dbpass) # connect to database 
  dat = dbSendQuery(con, statement = paste("select * from fishdat;", 
                                           sep = "")) # select all of the data
  dat = fetch(dat, n = -1) # queries and fetches data
  dat # return data from this function
}
```

Now, let's call our data-retrieving function. This is all of the catches recorded from last year's fishing tournament plus our class trip two weeks ago.

```{r}
dat = getDat(dbuser='fmuser', dbpass='swordfish')
head(dat)
```

Mark-recapture studies are useful for:
1) identifying species and stocks
2) estimating life-history parameters
3) characterizing environmental variability
4) gear selectivity

## Data Exploration

**Exercise** -- this will help with your assignment
Using the data, 
- calculate catch per lake *Bonus* plot `barplot` of catch by lake 
- plot Weight ~ Length for `bluegill` and `largemouth bass`
- histogram of Length for `bluegill` and `largemouth bass`
- calculate catch per species
- calculate top anglers and top gear

```{r}
# tabulating the amount of times a fish is caught at each lake


```


```{r}
# subset data for bluegill and largemouth bass species
# use ?subset to see what the function does
par(mfrow=c(1,2))


```

```{r}
# use your subsetted data to create Length histograms for each species
par(mfrow=c(1,2))


```

Calculate catch by species
***hint*** use `table()`
```{r}

```

Calculate top 5 anglers (where catch data was recorded) and top 5 gear
```{r}
sort(table(dat$angler), decreasing=T)[1:5]
sort(table(dat$bait_lure), decreasing=T)[1:5]
```


## Predicting Weight with WLR

$$
W = aL^b
$$

$$
log_eW = log_ea + b*log_eL 
$$

Here, we will use our subset of `largemouth bass` to predict weight where the data is missing. First, let's use the logarithmic form with a regression model. Once you have your model, plot scatter points of W~L and add a trendline with `predict()`


```{r}
kenmod = lm() # regress log(weight) ~ log(length) using your largemouth bass subset
summary(kenmod)

# plot W~L of LMB and predict weight with a line

```


Now, calculate a confidence interval for the parameter estimates generated by your model 
`[parameter estimate] +- 1.96*[standard error])` estimate and SE are given in `summary()`

```{r}

```


Then compare your estimates with average `largemouth bass` parameter estimates
- plot a histogram of `a` and `b` estimates from Fishbase and then plot a vertical line for their means
***hint*** use `hist()` and `abline(v=Ma)` # v for vertical line

```{r}
require(rfishbase)
dat2 = length_weight("Micropterus salmoides")
dat2 = as.data.frame(dat2)
Ma = exp(mean(log(dat2$a))) # geometric mean -Frose.etal.2006
Mb = mean(dat2$b) # mean across all b
```



Now, using the previous plot with your own parameter estimates, generate a new line with Fishbase parameter estimates.
- Which approach should you use for filling in missing values?

```{r}
# add a new column that predicts weight with new parameters and WLR
fbmod = lm() # create a similar regression model using Fishbase parameter estimates

# plot W~L of LMB and add both empiral and Fishbase trendlines
```


## CPUE

Calculate lake-specific CPUEs by biomass per unit effort and plot this.

```{r}

```

**Bonus** compare November 2021 and April 2022 CPUE

```{r}

```








